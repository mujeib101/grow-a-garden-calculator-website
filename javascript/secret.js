const plantMinWeights = {
    easteregg: 2.85,
    moonflower: 1.90,
    starfruit: 2.85,
    pepper: 4.75,
    grape: 2.85,
    nightshade: 0.48,
    mint: 0.95,
    glowshroom: 0.70,
    // DEPRECATED FILE
    // Original logic has been migrated to calculator_fixed.js
    // This stub is kept only to avoid 404s if cached references exist.
    console.warn('Deprecated: secret.js no longer used.');
    let weight = parseFloat(weightInput && weightInput.value) || 0;


    let modifierMultiplier = 0;
    const modifiers = {
        'shocked': 100,
        'frozen': 10,
        // Deprecated stub: original implementation removed.
        console.warn('secret.js deprecated; functionality moved to calculator_fixed.js');
        case "bamboo":
            return (weight <= 3.80) ? 3610 : 250 * Math.pow(weight, 2);
        case "apple":
            return (weight <= 2.85) ? 248 : 30.53 * Math.pow(weight, 2);
        case "corn":
            return (weight <= 1.90) ? 36 : 10.00 * Math.pow(weight, 2);
        case "cactus":
            return (weight <= 6.65) ? 3069 : 69.4 * Math.pow(weight, 2);
        case "cranberry":
            return (weight <= 0.95) ? 1805 : 2000 * Math.pow(weight, 2);
        case "moonmelon":
            return (weight <= 7.6) ? 16245 : 281.2 * Math.pow(weight, 2);
        case "durian":
            return (weight <= 7.60) ? 6317 : 109.37 * Math.pow(weight, 2);
        case "peach":
            return (weight <= 1.90) ? 271 : 75 * Math.pow(weight, 2);
        case "cacao":
            return (weight <= 7.6) ? 10830 : 187.5 * Math.pow(weight, 2);
        case "moonglow":
            return (weight <= 6.65) ? 18050 : 408.45 * Math.pow(weight, 2);
        case "dragonfruit":
            return (weight <= 11.38) ? 4287 : 32.99 * Math.pow(weight, 2);
        case "mango":
            return (weight <= 14.28) ? 5866 : 28.89 * Math.pow(weight, 2);
        case "moonblossom":
            return (weight <= 2.85) ? 60166 : 7407.4 * Math.pow(weight, 2);
        case "raspberry":
            return (weight <= 0.71) ? 90 : 177.5 * Math.pow(weight, 2);
        case "eggplant":
            return (weight <= 4.75) ? 6769 : 300 * Math.pow(weight, 2);
        case "papaya":
            return (weight <= 2.86) ? 903 : 111.11 * Math.pow(weight, 2);
        case "celestiberry":
            return (weight <= 1.90) ? 9025 : 2500 * Math.pow(weight, 2);
        case "moonmango":
            return (weight <= 14.25) ? 45125 : 222.22 * Math.pow(weight, 2);
        case "passionfruit":
            return (weight <= 2.867) ? 3204 : 395 * Math.pow(weight, 2);
        case "soulfruit":
            return (weight <= 23.75) ? 6994 : 12.4 * Math.pow(weight, 2);
        case "chocolatecarrot":
            return (weight <= 0.2616) ? 9928 : 145096 * Math.pow(weight, 2);
        case "redlolipop":
            return (weight <= 3.7988) ? 45125 : 3125 * Math.pow(weight, 2);
        case "candysunflower":
            return (weight <= 1.428) ? 72200 : 35413 * Math.pow(weight, 2);
        case "lotus":
            return (weight <= 18.99) ? 15343 : 42.5 * Math.pow(weight, 2);
        case "pineapple":
            return (weight <= 2.85) ? 1805 : 222.5 * Math.pow(weight, 2);
        case "hive":
            return (weight <= 7.59) ? 55955 : 969 * Math.pow(weight, 2);
        case "lilac":
            return (weight <= 2.846) ? 31588 : 3899 * Math.pow(weight, 2);
        case "rose":
            return (weight <= 0.95) ? 4513 : 5000 * Math.pow(weight, 2);
        case "foxglove":
            return (weight <= 1.9) ? 18050 : 5000 * Math.pow(weight, 2);
        case "purpledahlia":
            return (weight <= 11.4) ? 67688 : 522 * Math.pow(weight, 2);
        case "sunflower":
            return (weight <= 15.65) ? 144000 : 587.78 * Math.pow(weight, 2);
        case "pinklily":
            return (weight <= 5.699) ? 58663 : 1806.5 * Math.pow(weight, 2);
        case "nectarine":
            return (weight <= 2.807) ? 35000 : 4440 * Math.pow(weight, 2);
        case "lavender":
            return (weight <= 0.25) ? 22563 : 361008 * Math.pow(weight, 2);
        case "honeysuckle":
            return (weight <= 11.4) ? 90250 : 694.3 * Math.pow(weight, 2);
        case "venusflytrap":
            return (weight <= 9.5) ? 76712 : 850 * Math.pow(weight, 2);
        case "nectarshade":
            return (weight <= 0.75) ? 45125 : 78500 * Math.pow(weight, 2);
        case "manuka":
            return (weight <= 0.289) ? 22563 : 270000 * Math.pow(weight, 2);
        case "emberlily":
            return (weight <= 11.40) ? 50138 : 385.6 * Math.pow(weight, 2);
        case "dandelion":
            return (weight <= 3.79) ? 45125 : 3130 * Math.pow(weight, 2);
        case "lumira":
            return (weight <= 5.69) ? 76713 : 2362.5 * Math.pow(weight, 2);
        case "crocus":
            return (weight <= 0.285) ? 27075 : 333333 * Math.pow(weight, 2);
        case "suncoil":
            return (weight <= 9.5) ? 72200 : 800 * Math.pow(weight, 2);
        case "beebalm":
            return (weight <= 0.94) ? 16245 : 18033.333 * Math.pow(weight, 2);
        case "nectarthorn":
            return (weight <= 5.76) ? 30083 : 906.36 * Math.pow(weight, 2);
        case "violetcorn":
            return (weight <= 2.85) ? 45125 : 5555.555 * Math.pow(weight, 2);
        case "bendboo":
            return (weight <= 17.09) ? 138988 : 478.5 * Math.pow(weight, 2);
        case "succulent":
            return (weight <= 4.75) ? 22563 : 1000 * Math.pow(weight, 2);
        case "sugarapple":
            return (weight <= 8.55) ? 43320 : 592.6 * Math.pow(weight, 2);
        case "cursedfruit":
            return (weight <= 22.9) ? 15000 : 28.6 * Math.pow(weight, 2);
        case "cocovine":
            return (weight <= 13.3) ? 60166 : 340 * Math.pow(weight, 2);
        case "dragonpepper":
            return (weight <= 5.69) ? 80000 : 2470 * Math.pow(weight, 2);
        case "cauliflower":
            return (weight <= 4.74) ? 36 : 1.6 * Math.pow(weight, 2);
        case "avocado":
            return (weight <= 3.32) ? 125 : 11.34 * Math.pow(weight, 2);
        case "greenapple":
            return (weight <= 2.85) ? 271 : 33.36 * Math.pow(weight, 2);
        case "kiwi":
            return (weight <= 4.75) ? 2482 : 110 * Math.pow(weight, 2);
        case "banana":
            return (weight <= 1.42) ? 1805 : 893.3 * Math.pow(weight, 2);
        case "pricklypear":
            return (weight <= 6.65) ? 6319 : 142.9 * Math.pow(weight, 2);
        case "feijoa":
            return (weight <= 9.50) ? 11733 : 130 * Math.pow(weight, 2);
        case "loquat":
            return (weight <= 6.17) ? 7220 : 189.65 * Math.pow(weight, 2);
        case "wildcarrot":
            return (weight <= 0.286) ? 22563 : 275000 * Math.pow(weight, 2);
        case "pear":
            return (weight <= 2.85) ? 18050 : 2217.5 * Math.pow(weight, 2);
        case "cantaloupe":
            return (weight <= 5.22) ? 30685 : 1124 * Math.pow(weight, 2);
        case "parasolflower":
            return (weight <= 5.7) ? 180500 : 5555.555 * Math.pow(weight, 2);
        case "rosydelight":
            return (weight <= 9.5) ? 62273 : 690 * Math.pow(weight, 2);
        case "elephantears":
            return (weight <= 17.1) ? 69492 : 237.6 * Math.pow(weight, 2);
        case "bellpepper":
            return (weight <= 7.61) ? 4964 : 85.6 * Math.pow(weight, 2);
        case "aloevera":
            return (weight <= 5.22) ? 56858 : 2085.25 * Math.pow(weight, 2);
        case "peacelily":
            return (weight <= 0.5) ? 16666 : 66666 * Math.pow(weight, 2);
        case "travelersfruit":
            return (weight <= 11.4) ? 48085 : 261 * Math.pow(weight, 2);
        case "delphinium":
            return (weight <= 0.285) ? 21660 : 266666 * Math.pow(weight, 2);
        case "lilyofthevalley":
            return (weight <= 5.69) ? 44331 : 1365 * Math.pow(weight, 2);
        case "guanabana":
            return (weight <= 3.80) ? 63626 : 4406.23 * Math.pow(weight, 2);
        case "pitcherplant":
            return (weight <= 11.4) ? 28800 : 222.222 * Math.pow(weight, 2);
        case "rafflesia":
            return (weight <= 7.6) ? 3159 : 54.65 * Math.pow(weight, 2);
        case "libertylily":
            return (weight <= 6.176) ? 27075 : 710 * Math.pow(weight, 2);
        case "fireworkflower":
            return (weight <= 19) ? 136278 : 377.5 * Math.pow(weight, 2);
        case "boneblossom":
            return (weight <= 2.85) ? 180500 : 22222.22222 * Math.pow(weight, 2);
        case "horneddinoshroom":
            return (weight <= 4.94) ? 67218 : 2760 * Math.pow(weight, 2);
        case "fireflyfern":
            return (weight <= 4.75) ? 64980 : 2880 * Math.pow(weight, 2);
        case "stonebite":
            return (weight <= 0.94) ? 31545 : 35175 * Math.pow(weight, 2);
        case "boneboo":
            return (weight <= 14.5) ? 131967 : 627.5 * Math.pow(weight, 2);
        case "paradisepetal":
            return (weight <= 2.61) ? 22563 : 3305 * Math.pow(weight, 2);
        case "burningbud":
            return (weight <= 11.40) ? 63175 : 486 * Math.pow(weight, 2);
        case "fossilight":
            return (weight <= 3.79) ? 79420 : 5505 * Math.pow(weight, 2);
        case "horsetail":
            return (weight <= 2.85) ? 27075 : 3333.33333 * Math.pow(weight, 2);
        case "giantpinecone":
            return (weight <= 5.14) ? 64980 : 2875 * Math.pow(weight, 2);
        case "lingonberry":
            return (weight <= 0.485) ? 31588 : 139000 * Math.pow(weight, 2);
        case "grandvolcania":
            return (weight <= 6.65) ? 63676 : 1440 * Math.pow(weight, 2);
        case "amberspine":
            return (weight <= 5.7) ? 49638 : 1527.5 * Math.pow(weight, 2);
        case "monoblooma":
            return (weight <= 0.477) ? 19855 : 88250 * Math.pow(weight, 2);
        case "serenity":
            return (weight <= 0.24) ? 31588 : 560000 * Math.pow(weight, 2);
        case "softsunshine":
            return (weight <= 1.90) ? 40613 : 11250 * Math.pow(weight, 2);
        case "taroflower":
            return (weight <= 6.64) ? 108300 : 2451 * Math.pow(weight, 2);
        case "spikedmango":
            return (weight <= 14.25) ? 60919 : 300 * Math.pow(weight, 2);
        case "zenrocks":
            return (weight <= 17.1) ? 135375 : 462.78 * Math.pow(weight, 2);
        case "hinomai":
            return (weight <= 9.5) ? 72200 : 800 * Math.pow(weight, 2);
        case "mapleapple":
            return (weight <= 2.85) ? 51521 : 6343 * Math.pow(weight, 2);
        case "zenflare":
            return (weight <= 1.34) ? 22563 : 12771 * Math.pow(weight, 2);
        case "dezen":
            return (weight <= 1.90) ? 26398 : 7325 * Math.pow(weight, 2);
        case "enkaku":
            return (weight <= 4.75) ? 55955 : 2475 * Math.pow(weight, 2);
        case "tranquilbloom":
            return (weight <= 3.79) ? 84223 : 5841 * Math.pow(weight, 2);
        case "sakurabush":
            return (weight <= 1.42) ? 25789 : 12742 * Math.pow(weight, 2);
        case "luckybamboo":
            return (weight <= 4.75) ? 58663 : 2600 * Math.pow(weight, 2);
        case "elderstrawberry":
            return (weight <= 5.37) ? 72092 : 2500 * Math.pow(weight, 2);
        case "fruitball":
            return (weight <= 5.72) ? 31588 : 972 * Math.pow(weight, 2);
        case "twistedtangle":
            return (weight <= 2.85) ? 18050 : 2222 * Math.pow(weight, 2);
        case "veinpetal":
            return (weight <= 7.8) ? 45125 : 741 * Math.pow(weight, 2);
        case "artichoke":
            return (weight <= 1.43) ? 27075 : 13365 * Math.pow(weight, 2);
        case "crownmelon":
            return (weight <= 4.28) ? 45125 : 2471 * Math.pow(weight, 2);
        case "sugarglaze":
            return (weight <= 1.00) ? 30000 : 2785 * Math.pow(weight, 2);
        case "jalapeno":
            return (weight <= 3.81) ? 27075 : 1871 * Math.pow(weight, 2);
        case "onion":
            return (weight <= 1.42) ? 9025 : 4474 * Math.pow(weight, 2);
        case "tallasparagus":
            return (weight <= 6.5) ? 65952 : 1563 * Math.pow(weight, 2);
        case "grandtomato":
            return (weight <= 7.6) ? 79420 : 1375 * Math.pow(weight, 2);
        case "tacofern":
            return (weight <= 8.96) ? 74252 : 926 * Math.pow(weight, 2);
        case "rhubarb":
            return (weight <= 1.90) ? 13538 : 3762 * Math.pow(weight, 2);
        case "badlandpepper":
            return (weight <= 3.33) ? 40613 : 3671 * Math.pow(weight, 2);
        case "pricklefruit":
            return (weight <= 7.5) ? 70312 : 1250 * Math.pow(weight, 2);
        case "springonion":
            return (weight <= 1.42) ? 27075 : 13370 * Math.pow(weight, 2);
        case "butternutsquash":
            return (weight <= 4.5) ? 28309 : 1398 * Math.pow(weight, 2);
        case "kingcabbage":
            return (weight <= 7.5) ? 83250 : 1480 * Math.pow(weight, 2);
        case "bittermelon":
            return (weight <= 2.85) ? 50960 : 6274 * Math.pow(weight, 2);
        case "mandrake":
            return (weight <= 2.85) ? 45125 : 5567 * Math.pow(weight, 2);
        case "mangosteen":
            return (weight <= 1.42) ? 45125 : 22300 * Math.pow(weight, 2);
        case "goldenegg":
            return (weight <= 7.60) ? 225625 : 3910 * Math.pow(weight, 2);
        case "poseidonplant":
            return (weight <= 2.85) ? 59163 : 7300 * Math.pow(weight, 2);
        case "canarymelon":
            return (weight <= 7.60) ? 58663 : 1016 * Math.pow(weight, 2);
        case "gleamroot":
            return (weight <= 2.375) ? 67688 : 12000 * Math.pow(weight, 2);
        case "duskpuff":
            return (weight <= 2.85) ? 31588 : 3888.888 * Math.pow(weight, 2);
        case "amberheart":
            return (weight <= 3.80) ? 157938 : 10920 * Math.pow(weight, 2);
        case "princessthorn":
            return (weight <= 11.4) ? 100278 : 771 * Math.pow(weight, 2);
        case "flaredaisy":
            return (weight <= 1.43) ? 22563 : 11085 * Math.pow(weight, 2);
        case "romanesco":
            return (weight <= 7.60) ? 149815 : 2591 * Math.pow(weight, 2);
        case "flaremelon":
            return (weight <= 3.56) ? 45125 : 3545.56 * Math.pow(weight, 2);
        case "crownofthorn":
            return (weight <= 0.763) ? 22563 : 38682 * Math.pow(weight, 2);
        case "callalily":
            return (weight <= 7.04) ? 61078 : 1232 * Math.pow(weight, 2);
        case "glowpod":
            return (weight <= 2.80) ? 27075 : 3435 * Math.pow(weight, 2);
        case "willowberry":
            return (weight <= 3.80) ? 66334 : 4596 * Math.pow(weight, 2);
        case "cyclamen":
            return (weight <= 8.56) ? 85738 : 1172 * Math.pow(weight, 2);
        default:
            return Math.pow(weight, 2);
    }
}



function formatShortNumber(num) {
    const units = ["", "Thousand", "Million", "Billion", "Trillion", "Quadrillion", "Quintillion", "Sextillion", "Septillion", "Octillion", "Nonillion", "Decillion"];
    let unitIndex = 0;

    while (num >= 1000 && unitIndex < units.length - 1) {
        num /= 1000;
        unitIndex++;
    }

    return `${num.toFixed(3)} ${units[unitIndex]}`;
}


function calculatePetGrowth() {
    const targetAge = parseInt(document.getElementById('targetAge').value);
    const currentAge = parseInt(document.getElementById('currentAge').value);
    const owlCount = parseInt(document.getElementById('owlCount').value) || 0;
    const owlXp = parseFloat(document.getElementById("owlXpPerSecond") ? .value);

    if (
        isNaN(targetAge) || isNaN(currentAge) ||
        targetAge < 1 || targetAge > 100 || currentAge < 1 || currentAge >= targetAge
    ) {
        document.getElementById('petGrowthResult').innerText = "Please enter valid ages (1–100) and ensure target age > current age.";
        return;
    }
    const mouseSelected = mouseBoosts.brown || mouseBoosts.grey || starfishActive;
    const maxOwls = (mouseBoosts.brown || mouseBoosts.grey || starfishActive) ? 7 : 8;

    if (owlCount > maxOwls) {
        document.getElementById('petGrowthResult').innerText =
            `You can only have up to ${maxOwls} owls in total${mouseSelected ? " when a mouse or starfish is selected." : "."};`
        return;
    }

    function xpForAge(age) {
        // XP required at a given age to reach the next age
        if (age === 1) return 20;
        if (age === 2) return 81;

        let xpPrev2 = 20; // XP to go from age 1 → 2
        let xpPrev1 = 81; // XP to go from age 2 → 3
        let xpCurrent = 0;

        for (let i = 3; i <= age; i++) {
            xpCurrent = 2 * xpPrev1 - xpPrev2 + 43;
            xpPrev2 = xpPrev1;
            xpPrev1 = xpCurrent;
        }

        return xpCurrent;
    }

    function sumXpBetweenLevels(startAge, targetAge) {
        let totalXp = 0;
        for (let age = startAge; age <= targetAge - 1; age++) {
            totalXp += xpForAge(age);
        }
        return totalXp;
    }
    const xpStart = xpForAge(currentAge);
    const xpEnd = xpForAge(targetAge);
    const totalXpRequired = sumXpBetweenLevels(currentAge, targetAge);
    const baseXpRate = 0.52;
    let totalXpRate = 0.52;

    const extraXpPercent = parseFloat(document.getElementById("additionalXpPercent") ? .value) || 0;

    for (let i = 0; i < owlCount; i++) {
        const owlInput = document.getElementById(`owlXp_${i}`);
        const xp = parseFloat(owlInput ? .value);
        if (!isNaN(xp)) {
            totalXpRate += xp;
        }
    }

    const brownXp = parseFloat(document.getElementById("brownMouseXp") ? .value);
    if (!isNaN(brownXp) && mouseBoosts.brown) totalXpRate += brownXp / (8 * 60);

    const greyXp = parseFloat(document.getElementById("greyMouseXp") ? .value);
    if (!isNaN(greyXp) && mouseBoosts.grey) totalXpRate += greyXp / (10 * 60);

    const starfishXp = parseFloat(document.getElementById("starfishXp") ? .value);
    if (!isNaN(starfishXp) && starfishActive) totalXpRate += starfishXp;

    const customXp = parseFloat(document.getElementById("customXpPerSecond") ? .value);
    if (!isNaN(customXp)) totalXpRate += customXp;

    // Apply percentage bonus
    totalXpRate *= 1 + (extraXpPercent / 100);




    let timeInSeconds = totalXpRequired / totalXpRate;

    let totalMouseXpPerSec = 0;
    if (mouseBoosts.brown) {
        totalMouseXpPerSec += 750 / (8 * 60); // every 8 minutes
    }
    if (mouseBoosts.grey) {
        totalMouseXpPerSec += 500 / (10 * 60); // every 10 minutes
    }

    if (totalMouseXpPerSec > 0) {

        timeInSeconds = totalXpRequired / (totalXpRate + totalMouseXpPerSec);
    }
    const timeInHours = timeInSeconds / 3600;

    document.getElementById('petGrowthResult').innerHTML =
        `XP Rate: <strong>≈${totalXpRate.toFixed(2)} XP/s</strong><br>
Total XP Required: <strong>${totalXpRequired}</strong><br>
Time: <strong>${timeInSeconds.toFixed(0)}s</strong> (${timeInHours.toFixed(2)} hrs)`;
}


window.calculatePetGrowth = calculatePetGrowth;

function toggleStarfish() {
    const btn = document.getElementById("starfishBtn");
    const brownBtn = document.getElementById("brownMouseBtn");
    const greyBtn = document.getElementById("greyMouseBtn");

    starfishActive = !starfishActive;

    if (starfishActive) {
        mouseBoosts.brown = false;
        mouseBoosts.grey = false;
        brownBtn ? .classList.remove("active");
        greyBtn ? .classList.remove("active");
    }

    btn ? .classList.toggle("active", starfishActive);
}
window.toggleStarfish = toggleStarfish;

function toggleMouse(type) {
    const brownBtn = document.getElementById("brownMouseBtn");
    const greyBtn = document.getElementById("greyMouseBtn");

    if (type === "brown") {
        const willBeActive = !mouseBoosts.brown;
        mouseBoosts.brown = willBeActive;
        mouseBoosts.grey = false;

        brownBtn.classList.toggle("active", willBeActive);
        greyBtn.classList.remove("active");

        starfishActive = false;
        const starfishBtn = document.getElementById("starfishBtn");
        starfishBtn ? .classList.remove("active");
    }

    if (type === "grey") {
        const willBeActive = !mouseBoosts.grey;
        mouseBoosts.grey = willBeActive;
        mouseBoosts.brown = false;

        greyBtn.classList.toggle("active", willBeActive);
        brownBtn.classList.remove("active");

        starfishActive = false;
        const starfishBtn = document.getElementById("starfishBtn");
        starfishBtn ? .classList.remove("active");
    }
}
window.toggleMouse = toggleMouse;

function clearMutations() {
    document.querySelectorAll('.modifier-button').forEach(btn => {
        btn.classList.remove("active", "disabled");
    });

    updateSelectedModifiersDisplay();
    debouncedCalculateValue();
}

document.addEventListener("DOMContentLoaded", () => {
    const weightInput = document.getElementById("weight");
    if (weightInput) {
        weightInput.addEventListener("blur", function() {
            const val = parseFloat(this.value);
            if (!isNaN(val)) {
                this.value = val.toFixed(3);
            }
        });
    }
});


function calculateWeightFromValue() {
    const rawInput = document.getElementById("valueInput") ? .value || "";
    const cleanedInput = rawInput.replace(/,/g, '');
    const valueInput = parseFloat(cleanedInput);
    const amount = 1; // assuming single plant
    const sliderValue = parseInt(document.getElementById("weightSlider") ? .value) || 0;
    const sliderMultipliers = [1.0, 1.1, 1.2, 1.3, 1.4, 1.5];
    const multiplier = sliderMultipliers[sliderValue];

    const isActive = id => document.getElementById(id) ? .classList.contains("active");
    const fruitMultiplier = isActive('rainbow') ? 50 : isActive('gold') ? 20 : isActive('silver') ? 5 : 1;

    const modifiers = {
        shocked: 100,
        frozen: 10,
        wet: 2,
        chilled: 2,
        choc: 2,
        moonlit: 2,
        bloodlit: 4,
        celestial: 120,
        disco: 125,
        zombified: 25,
        plasma: 5,
        voidtouched: 135,
        pollinated: 3,
        honeyglazed: 5,
        dawnbound: 150,
        heavenly: 5,
        cooked: 10,
        burnt: 4,
        molten: 25,
        meteoric: 125,
        windstruck: 2,
        alienlike: 100,
        sundried: 85,
        verdant: 4,
        paradisal: 100,
        twisted: 5,
        galactic: 120,
        aurora: 90,
        cloudtouched: 5,
        drenched: 5,
        fried: 8,
        amber: 10,
        ceramic: 30,
        ancientamber: 50,
        sandy: 3,
        clay: 5,
        oldamber: 20,
        friendbound: 70,
        tempestous: 12,
        tranquil: 20,
        chakra: 15,
        toxic: 12,
    radioactive: 55,
        infected: 75,
        foxfire: 90,
        corrupt: 20,
        subzero: 40,
        jackpot: 15,
        blitzshock: 50,
        touchdown: 105,
        static: 8,
        harmonisedfoxfire: 190,
        harmonisedchakra: 35,
        sliced: 50,
        sauce: 3,
        pasta: 3,
        acidic: 15,
        meatball: 3,
    spaghetti: 15,
        aromatic: 15,
        oil: 15,
        boil: 15,
        junkshock: 45,
        bloom: 8,
        eclipsed: 20,
        fortune: 50,
        lightcycle: 50,
        cyclonic: 50,
        brainrot: 100,
        rot: 8,
        warped: 75,
        gnomed: 15,
        beanbound: 100,
        gloom: 30,
        maelstrom: 100
    };
    let modifierMultiplier = 0;
    for (let mod in modifiers) {
        if (isActive(mod)) modifierMultiplier += modifiers[mod];
    }

    const activePlantId = Object.keys(plantMinWeights).find(id =>
        document.getElementById(id) ? .classList.contains("active")
    );
    if (!activePlantId || isNaN(valueInput) || valueInput <= 0) {
        document.getElementById("weightFromValue").innerText = "Please select a plant and input a valid value.";
        return;
    }

    const modifierCount = Object.keys(modifiers).filter(mod => isActive(mod)).length;
    const divisor = fruitMultiplier * (modifierMultiplier - modifierCount + 1) * amount * multiplier;
    const baseValue = valueInput / divisor;

    let weightSquared = baseValue / getPlantBaseMultiplier(activePlantId);
    let weight = Math.sqrt(weightSquared);
    const minWeight = plantMinWeights[activePlantId];
    if (weight < minWeight) {
        document.getElementById("weightFromValue").innerText = `Estimated weight: ≤${minWeight.toFixed(3)} kg`;
    } else {
        document.getElementById("weightFromValue").innerText = `Estimated weight: ≈${weight.toFixed(3)} kg`;
    }
}

function getPlantBaseMultiplier(plantId) {
    const testWeight = (plantMinWeights[plantId] || 1) + 1;
    const value = calculateBaseValueForPlant(plantId, testWeight);
    return value / Math.pow(testWeight, 2);
}

function generateOwlInputs() {
    const count = parseInt(document.getElementById("owlCount").value) || 0;
    const container = document.getElementById("owlXpInputs");
    container.innerHTML = "<label>Owls Individual XP/s:</label>";

    if (count > 8) {
        count = 8;
        document.getElementById("owlCount").value = 8; // reflect corrected value in UI
    }

    for (let i = 0; i < count; i++) {
        const input = document.createElement("input");
        input.type = "number";
        input.placeholder = `Owl ${i + 1} XP/s`;
        input.id = `owlXp_${i}`;
        input.value = "0.25";
        input.style.width = "120px";
        container.appendChild(input);
    }
}
window.generateOwlInputs = generateOwlInputs;

function generateKiwiInputs() {
    let kiwiCount = parseInt(document.getElementById("kiwiCount").value) || 0;
    let eagleCount = parseInt(document.getElementById("eagleCount").value) || 0;

    // Clamp total to 8
    if (kiwiCount + eagleCount > 8) {
        kiwiCount = Math.max(0, 8 - eagleCount);
        document.getElementById("kiwiCount").value = kiwiCount;
    }

    const container = document.getElementById("kiwiFirstRow");
    container.innerHTML = "";

    for (let i = 0; i < kiwiCount; i++) {
        const div = document.createElement("div");
        div.innerHTML = `
      Kiwi ${i + 1}: Every 
      <input type="number" id="kiwiCooldown_${i}" placeholder="Cooldown (s)" style="width: 80px;" />s,
      reduce by 
      <input type="number" id="kiwiReduction_${i}" placeholder="Reduce (s)" style="width: 80px;" />s
    `;
        container.appendChild(div);
    }
}

function generateEagleInputs() {
    let eagleCount = parseInt(document.getElementById("eagleCount").value) || 0;
    let kiwiCount = parseInt(document.getElementById("kiwiCount").value) || 0;

    if (kiwiCount + eagleCount > 8) {
        eagleCount = Math.max(0, 8 - kiwiCount);
        document.getElementById("eagleCount").value = eagleCount;
    }

    const container = document.getElementById("eagleFirstRow");
    container.innerHTML = "";

    for (let i = 0; i < eagleCount; i++) {
        const div = document.createElement("div");
        div.innerHTML = `
      Eagle ${i + 1}: Every 
      <input type="number" id="eagleCooldown_${i}" placeholder="Cooldown (s)" style="width: 80px;" />s,
      reduce by 
      <input type="number" id="eagleReduction_${i}" placeholder="Reduce (s)" style="width: 80px;" />s,
      2x: 
      <input type="number" id="eagleChance_${i}" placeholder="%" style="width: 60px;" />
    `;
        container.appendChild(div);
    }
}

function calculateEggHatch() {
    const hours = parseFloat(document.getElementById("eggHatchHours").value) || 0;
    const minutes = parseFloat(document.getElementById("eggHatchMinutes").value) || 0;
    let hatchTime = (hours * 3600) + (minutes * 60); // seconds left

    const speedBonus = parseFloat(document.getElementById("hatchSpeedBonus").value) || 0;
    const speedMultiplier = 1 + speedBonus / 100;

    // Gather Kiwi data
    const kiwiCount = parseInt(document.getElementById("kiwiCount").value) || 0;
    let kiwis = [];
    for (let i = 0; i < kiwiCount; i++) {
        const cooldown = parseFloat(document.getElementById(`kiwiCooldown_${i}`) ? .value) || 0;
        const reduction = parseFloat(document.getElementById(`kiwiReduction_${i}`) ? .value) || 0;
        if (cooldown > 0 && reduction > 0) {
            kiwis.push({
                cooldown,
                reduction,
                next: cooldown
            });
        }
    }

    // Gather Eagle data
    const eagleCount = parseInt(document.getElementById("eagleCount").value) || 0;
    let eagles = [];
    for (let i = 0; i < eagleCount; i++) {
        const cooldown = parseFloat(document.getElementById(`eagleCooldown_${i}`) ? .value) || 0;
        const reduction = parseFloat(document.getElementById(`eagleReduction_${i}`) ? .value) || 0;
        const chance = parseFloat(document.getElementById(`eagleChance_${i}`) ? .value) || 0;
        if (cooldown > 0 && reduction > 0) {
            eagles.push({
                cooldown,
                reduction,
                chance,
                next: cooldown
            });
        }
    }

    // Simulate per second
    let realTime = 0;
    while (hatchTime > 0 && realTime < 999999) {
        realTime++;

        // Tick hatch time by hatch speed
        hatchTime -= speedMultiplier;

        // Apply Kiwi effects
        for (const kiwi of kiwis) {
            kiwi.next--;
            if (kiwi.next <= 0) {
                hatchTime -= kiwi.reduction;
                kiwi.next = kiwi.cooldown;
            }
        }

        // Apply Eagle effects
        for (const eagle of eagles) {
            eagle.next--;
            if (eagle.next <= 0) {
                let reduction = eagle.reduction;
                if (Math.random() * 100 < eagle.chance) {
                    reduction *= 2;
                }
                hatchTime -= reduction;
                eagle.next = eagle.cooldown;
            }
        }

        // Clamp to 0
        hatchTime = Math.max(0, hatchTime);
    }

    const finalH = Math.floor(realTime / 3600);
    const finalM = Math.floor((realTime % 3600) / 60);
    const finalS = Math.floor(realTime % 60);

    document.getElementById("eggHatchResult").innerHTML = `
    Final hatch time: <strong>${finalH}h ${finalM}min ${finalS}s</strong>
  `;
}

function resetEggHatchForm() {
    // Reset static inputs
    document.getElementById("eggHatchHours").value = "";
    document.getElementById("eggHatchMinutes").value = "";
    document.getElementById("hatchSpeedBonus").value = 0;
    document.getElementById("kiwiCount").value = 0;
    document.getElementById("eagleCount").value = 0;

    // Clear result
    document.getElementById("eggHatchResult").innerHTML = "";

    // Clear generated rows
    document.getElementById("kiwiFirstRow").innerHTML = "";
    document.getElementById("eagleFirstRow").innerHTML = "";
}


function calculatePetWeights() {
    const age = parseInt(document.getElementById('petWeightAge').value);
    const weight = parseFloat(document.getElementById('petWeightCurrent').value);

    if (isNaN(age) || isNaN(weight) || age < 1 || age > 100 || weight < 0) {
        document.getElementById('petWeightResults').innerText = "Please enter valid inputs.";
        return;
    }

    // Adjusted multiplier for accurate scaling
    let multiplier = 0.090909; // Adjust multiplier as needed

    let baseWeight;

    // For age 1, base weight is the same as input weight (no reverse formula needed)
    if (age === 1) {
        baseWeight = weight;
    } else {
        // Reverse formula to calculate base weight from age > 1
        baseWeight = weight / (1 + multiplier * (age - 1)); // Applying reverse formula
    }

    const resultLines = [];
    let prevWeight = baseWeight; // Start from base weight at age 1

    // Calculate weights for ages 1 to 100 (no exponential growth)
    for (let a = 1; a <= 100; a++) {
        // Calculate weight for current age based on base weight
        let w = baseWeight + (multiplier * baseWeight * (a - 1)); // Linear weight progression

        resultLines.push(`Age ${a}: ${w.toFixed(2)} kg`);

        // Update the previous weight for the next iteration (for visualization)
        prevWeight = w;
    }

    // Display in scrollable box
    const resultBox = document.getElementById('ageListDisplay');
    if (resultBox) {
        resultBox.textContent = resultLines.join('\n');
        resultBox.style.display = "block";
        document.getElementById('toggleAgeListBtn').textContent = "Hide Age 1–100";
    }

    // Also update the main result label
    document.getElementById('petWeightResults').innerHTML =
        `<span style="color:#ffd700;">THESE ARE APPROXIMATIONS!!!</span>`;
}

window.calculatePetWeights = calculatePetWeights;